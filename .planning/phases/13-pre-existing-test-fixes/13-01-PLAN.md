---
phase: 13-pre-existing-test-fixes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: true
requirements: ["TECHDEBT-13"]
must_haves:
  truths:
    - "All 13 tests in auth-service account-lockout.test.ts pass"
    - "All 12 tests in profile-service search-filters.test.ts pass"
    - "No test regressions in auth-service (211 passing, 1 skipped)"
    - "No test regressions in profile-service (123 passing)"
  artifacts: []
  key_links: []
---

<objective>
Verify that pre-existing test failures in auth-service and profile-service are resolved.

Purpose: Commit 09c7028 ("test: enhance isolation of account lockout and search filters tests with shared mocks") already fixed all 22 originally-failing tests by adding comprehensive jest.mock('@vlvt/shared', ...) blocks and additional dependency mocks. This plan confirms the fix is still green and documents the verification.

Output: Verified test results confirming all success criteria are met. No code changes needed.
</objective>

<execution_context>
@C:/Users/dasbl/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/dasbl/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-pre-existing-test-fixes/13-RESEARCH.md

This is a verification-only plan. The implementation was completed in commit 09c7028 before the v2.0 audit created the Phase 13 roadmap entry. No files are modified -- only tests are run to confirm the fix holds.

**Background:** Phase 8 introduced `@vlvt/shared` with `createPool()`. Phase 11 added CSRF middleware, audit logging, and version middleware to the shared package. These new imports broke test files that only mocked `pg` but not `@vlvt/shared`. Commit 09c7028 added full `jest.mock('@vlvt/shared', ...)` blocks to both test files.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify account-lockout tests pass in auth-service</name>
  <files>backend/auth-service/tests/account-lockout.test.ts</files>
  <action>
Run the account-lockout test suite in auth-service to confirm all tests pass:

```bash
cd backend/auth-service && npx jest tests/account-lockout.test.ts --no-coverage --verbose
```

Then run the full auth-service test suite to confirm no regressions:

```bash
cd backend/auth-service && npx jest --no-coverage
```

Expected results:
- account-lockout.test.ts: 13 tests passing (3 account lockout, 2 counter reset, 2 unlock, 3 response format, 3 edge cases)
- Full suite: 15 suites, 211 passing, 1 skipped

If any tests fail, investigate whether the failure is a regression from recent Phase 12 changes (shutdown ordering) or a new issue. Do NOT modify code -- report the failure for triage.
  </action>
  <verify>
    <automated>cd backend/auth-service && npx jest tests/account-lockout.test.ts --no-coverage 2>&1 | grep -E "Tests:|Test Suites:"</automated>
  </verify>
  <done>account-lockout.test.ts shows 13 passed, 0 failed. Full auth-service suite shows 15 suites passed, 211 tests passed.</done>
</task>

<task type="auto">
  <name>Task 2: Verify search-filters tests pass in profile-service</name>
  <files>backend/profile-service/tests/search-filters.test.ts</files>
  <action>
Run the search-filters test suite in profile-service to confirm all tests pass:

```bash
cd backend/profile-service && npx jest tests/search-filters.test.ts --no-coverage --verbose
```

Then run the full profile-service test suite to confirm no regressions:

```bash
cd backend/profile-service && npx jest --no-coverage
```

Expected results:
- search-filters.test.ts: 12 tests passing (2 distance, 2 age, 2 gender, 2 preference, 2 intent, 2 combined, 2 edge cases)
- Full suite: 10 suites, 123 passing, 0 skipped

If any tests fail, investigate and report. Do NOT modify code.
  </action>
  <verify>
    <automated>cd backend/profile-service && npx jest tests/search-filters.test.ts --no-coverage 2>&1 | grep -E "Tests:|Test Suites:"</automated>
  </verify>
  <done>search-filters.test.ts shows 12 passed, 0 failed. Full profile-service suite shows 10 suites passed, 123 tests passed.</done>
</task>

</tasks>

<verification>
1. `cd backend/auth-service && npx jest --no-coverage` -- 15 suites, 211 passed, 1 skipped, 0 failed
2. `cd backend/profile-service && npx jest --no-coverage` -- 10 suites, 123 passed, 0 failed
3. No code changes made (files_modified is empty)
</verification>

<success_criteria>
- All 13 tests in auth-service account-lockout.test.ts pass (originally reported as 12 failing -- actual count is 13)
- All 12 tests in profile-service search-filters.test.ts pass (originally reported as 10 failing -- actual count is 12)
- No new test regressions in either service
</success_criteria>

<output>
After completion, create `.planning/phases/13-pre-existing-test-fixes/13-01-SUMMARY.md`
</output>
