---
phase: 04-bug-fixes-ui-polish
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - frontend/lib/screens/*.dart
autonomous: true

must_haves:
  truths:
    - "All loading states use VlvtLoader consistently"
    - "All error states use ErrorHandler and show retry options"
    - "All empty states use EmptyStateWidget or branded variants"
  artifacts:
    - path: "frontend/lib/screens/matches_screen.dart"
      provides: "Loading, error, empty state handling"
      contains: "VlvtLoader"
  key_links:
    - from: "screens/*.dart"
      to: "widgets/vlvt_loader.dart"
      via: "import and usage"
      pattern: "VlvtLoader"
---

<objective>
Fix loading, error, and empty state handling across all screens

Purpose: Users never see blank screens, raw errors, or empty lists without guidance
Output: All screens display proper feedback during loading, on error, and when empty
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/04-bug-fixes-ui-polish/04-CONTEXT.md
@.planning/phases/04-bug-fixes-ui-polish/04-RESEARCH.md
@.planning/phases/04-bug-fixes-ui-polish/04-AUDIT.md
@.planning/phases/04-bug-fixes-ui-polish/04-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix Critical State Handling Issues</name>
  <files>from 04-AUDIT.md critical/high priority items related to states</files>
  <action>
Based on 04-AUDIT.md findings, fix all Critical and High priority issues related to:
- Missing loading states
- Missing or raw error messages
- Missing empty states

For each issue, apply the established patterns from 04-RESEARCH.md:

**Loading Pattern:**
```dart
if (_isLoading) {
  return Scaffold(
    backgroundColor: VlvtColors.background,
    body: const Center(child: VlvtLoader()),
  );
}
```

**Error Pattern:**
```dart
try {
  // API call
} catch (e) {
  final friendlyError = ErrorHandler.handleError(e);
  setState(() {
    _errorMessage = '${friendlyError.message}\n${friendlyError.guidance}';
    _isLoading = false;
  });
}

// In build():
if (_errorMessage != null) {
  return Center(
    child: Column(
      mainAxisAlignment: MainAxisAlignment.center,
      children: [
        Icon(Icons.error_outline, size: 64, color: VlvtColors.crimson),
        const SizedBox(height: 16),
        Padding(
          padding: const EdgeInsets.symmetric(horizontal: 32),
          child: Text(
            _errorMessage!,
            style: VlvtTextStyles.bodyMedium.copyWith(color: VlvtColors.textSecondary),
            textAlign: TextAlign.center,
          ),
        ),
        const SizedBox(height: 16),
        VlvtButton.primary(label: 'Retry', onPressed: _loadData),
      ],
    ),
  );
}
```

**Empty State Pattern:**
```dart
if (_items.isEmpty) {
  return EmptyStateWidget(
    icon: Icons.inbox_outlined,
    iconColor: VlvtColors.gold,
    title: 'Nothing here yet',
    message: 'Helpful message guiding next action',
    actionLabel: 'Take Action',
    onAction: _handleAction,
  );
}
```

Ensure all imports are added:
- `import '../widgets/vlvt_loader.dart';`
- `import '../utils/error_handler.dart';`
- `import '../widgets/empty_state_widget.dart';`
  </action>
  <verify>
Run `flutter analyze` with no new errors
  </verify>
  <done>All critical/high state handling issues fixed per audit findings</done>
</task>

<task type="auto">
  <name>Task 2: Fix Medium Priority State Issues</name>
  <files>from 04-AUDIT.md medium priority items related to states</files>
  <action>
Address remaining Medium priority state handling issues from 04-AUDIT.md.

Focus on:
1. Inconsistent loading indicator styles (replace CircularProgressIndicator with VlvtLoader)
2. Generic error messages that could be more helpful
3. Empty states that lack call-to-action buttons
4. Loading states without timeout handling

Also ensure:
- All screens that make API calls have `_isLoading` state variable
- Error catch blocks use `ErrorHandler.handleError()` not raw exception messages
- Lists/grids check `items.isEmpty` and show appropriate empty state
  </action>
  <verify>
`flutter analyze` passes with no errors
  </verify>
  <done>All identified state handling issues from audit resolved</done>
</task>

</tasks>

<verification>
- [ ] No screens show blank white during loading (all use VlvtLoader)
- [ ] No raw exception text shown to users (all use ErrorHandler)
- [ ] No empty lists without EmptyStateWidget
- [ ] All error states have retry option
- [ ] `flutter analyze` passes
</verification>

<success_criteria>
Every screen handles all three states (loading, error, empty) using the established design system patterns. Users never see:
1. Blank screens during loading
2. Technical error messages
3. Empty content areas without guidance
</success_criteria>

<output>
After completion, create `.planning/phases/04-bug-fixes-ui-polish/04-02-SUMMARY.md`
</output>
