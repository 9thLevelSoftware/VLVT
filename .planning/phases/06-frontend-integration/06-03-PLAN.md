---
phase: 06-frontend-integration
plan: 03
type: execute
wave: 2
depends_on: ["06-01", "06-02"]
files_modified:
  - frontend/lib/screens/after_hours_tab_screen.dart
  - frontend/lib/widgets/after_hours/session_timer.dart
  - frontend/lib/widgets/after_hours/searching_animation.dart
  - frontend/lib/widgets/after_hours/session_expiry_banner.dart
autonomous: true

must_haves:
  truths:
    - "User sees setup prompts if profile/preferences incomplete"
    - "User can start session with duration selection"
    - "Active session shows countdown timer"
    - "Searching state shows animation and nearby user count"
    - "Expiring state shows warning banner"
  artifacts:
    - path: "frontend/lib/screens/after_hours_tab_screen.dart"
      provides: "Full session flow UI based on state"
      contains: "AfterHoursTabScreen"
      min_lines: 200
    - path: "frontend/lib/widgets/after_hours/session_timer.dart"
      provides: "Countdown timer widget"
      exports: ["SessionTimer"]
      min_lines: 80
    - path: "frontend/lib/widgets/after_hours/searching_animation.dart"
      provides: "Searching nearby animation"
      exports: ["SearchingAnimation"]
      min_lines: 50
    - path: "frontend/lib/widgets/after_hours/session_expiry_banner.dart"
      provides: "Expiry warning banner"
      exports: ["SessionExpiryBanner"]
      min_lines: 40
  key_links:
    - from: "frontend/lib/screens/after_hours_tab_screen.dart"
      to: "after_hours_service.dart"
      via: "context.watch for state changes"
      pattern: "context\\.watch<AfterHoursService>"
    - from: "frontend/lib/widgets/after_hours/session_timer.dart"
      to: "after_hours_service.dart"
      via: "expiresAt timestamp"
      pattern: "expiresAt"
---

<objective>
Build the session activation flow UI and timer widgets for After Hours mode.

Purpose: Users need a clear flow to start a session (including setup prompts), see their remaining time, and get warnings before expiry.

Output: Complete tab screen with state-driven UI, session timer, searching animation, and expiry banner widgets.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-frontend-integration/06-CONTEXT.md
@.planning/phases/06-frontend-integration/06-RESEARCH.md

Reference prior plan summaries (if available):
@.planning/phases/06-frontend-integration/06-01-SUMMARY.md
@.planning/phases/06-frontend-integration/06-02-SUMMARY.md

Reference existing patterns:
@frontend/lib/services/after_hours_service.dart (state machine)
@frontend/lib/services/after_hours_profile_service.dart (profile/prefs)
@frontend/lib/services/location_service.dart (location access)
@frontend/lib/theme/vlvt_colors.dart (colors)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create session timer and supporting widgets</name>
  <files>frontend/lib/widgets/after_hours/session_timer.dart, frontend/lib/widgets/after_hours/searching_animation.dart, frontend/lib/widgets/after_hours/session_expiry_banner.dart</files>
  <action>
Create the widgets directory and three widgets:

1. **session_timer.dart** - Countdown timer widget:

```dart
/// Session Timer Widget
/// Displays countdown timer with visual urgency states
library;

import 'dart:async';
import 'package:flutter/material.dart';
import '../../theme/vlvt_colors.dart';

class SessionTimer extends StatefulWidget {
  final DateTime expiresAt;
  final VoidCallback? onExpired;
  final VoidCallback? onWarning; // Called at 2 min remaining

  const SessionTimer({
    super.key,
    required this.expiresAt,
    this.onExpired,
    this.onWarning,
  });

  @override
  State<SessionTimer> createState() => _SessionTimerState();
}

class _SessionTimerState extends State<SessionTimer> {
  Timer? _timer;
  Duration _remaining = Duration.zero;
  bool _warningShown = false;

  @override
  void initState() {
    super.initState();
    _updateRemaining();
    _timer = Timer.periodic(const Duration(seconds: 1), (_) => _updateRemaining());
  }

  @override
  void didUpdateWidget(SessionTimer oldWidget) {
    super.didUpdateWidget(oldWidget);
    if (oldWidget.expiresAt != widget.expiresAt) {
      _warningShown = false;
      _updateRemaining();
    }
  }

  @override
  void dispose() {
    _timer?.cancel();
    super.dispose();
  }

  void _updateRemaining() {
    final now = DateTime.now();
    final remaining = widget.expiresAt.difference(now);

    if (remaining.inSeconds <= 0) {
      widget.onExpired?.call();
      _timer?.cancel();
      setState(() => _remaining = Duration.zero);
      return;
    }

    if (remaining.inSeconds <= 120 && !_warningShown) {
      _warningShown = true;
      widget.onWarning?.call();
    }

    setState(() => _remaining = remaining);
  }

  @override
  Widget build(BuildContext context) {
    final isUrgent = _remaining.inSeconds <= 120;
    final minutes = _remaining.inMinutes;
    final seconds = _remaining.inSeconds % 60;

    return Container(
      padding: const EdgeInsets.symmetric(horizontal: 16, vertical: 8),
      decoration: BoxDecoration(
        color: isUrgent ? VlvtColors.crimson : VlvtColors.gold,
        borderRadius: BorderRadius.circular(20),
        boxShadow: isUrgent ? [
          BoxShadow(
            color: VlvtColors.crimson.withOpacity(0.4),
            blurRadius: 8,
            spreadRadius: 0,
          ),
        ] : null,
      ),
      child: Row(
        mainAxisSize: MainAxisSize.min,
        children: [
          Icon(
            Icons.timer,
            color: isUrgent ? Colors.white : VlvtColors.textOnGold,
            size: 16,
          ),
          const SizedBox(width: 4),
          Text(
            '${minutes.toString().padLeft(2, '0')}:${seconds.toString().padLeft(2, '0')}',
            style: TextStyle(
              color: isUrgent ? Colors.white : VlvtColors.textOnGold,
              fontWeight: FontWeight.bold,
              fontFamily: 'Montserrat',
              fontSize: 14,
            ),
          ),
        ],
      ),
    );
  }
}
```

2. **searching_animation.dart** - Searching nearby animation:

```dart
/// Searching Animation Widget
/// Shows pulsing radar-style animation while searching for matches
library;

import 'package:flutter/material.dart';
import '../../theme/vlvt_colors.dart';
import '../../theme/vlvt_text_styles.dart';

class SearchingAnimation extends StatefulWidget {
  final int nearbyCount;

  const SearchingAnimation({
    super.key,
    required this.nearbyCount,
  });

  @override
  State<SearchingAnimation> createState() => _SearchingAnimationState();
}

class _SearchingAnimationState extends State<SearchingAnimation>
    with SingleTickerProviderStateMixin {
  late AnimationController _controller;
  late Animation<double> _scaleAnimation;
  late Animation<double> _opacityAnimation;

  @override
  void initState() {
    super.initState();
    _controller = AnimationController(
      duration: const Duration(seconds: 2),
      vsync: this,
    )..repeat();

    _scaleAnimation = Tween<double>(begin: 0.5, end: 1.5).animate(
      CurvedAnimation(parent: _controller, curve: Curves.easeOut),
    );

    _opacityAnimation = Tween<double>(begin: 0.8, end: 0.0).animate(
      CurvedAnimation(parent: _controller, curve: Curves.easeOut),
    );
  }

  @override
  void dispose() {
    _controller.dispose();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    return Column(
      mainAxisSize: MainAxisSize.min,
      children: [
        SizedBox(
          width: 200,
          height: 200,
          child: Stack(
            alignment: Alignment.center,
            children: [
              // Pulsing rings
              AnimatedBuilder(
                animation: _controller,
                builder: (context, child) {
                  return Transform.scale(
                    scale: _scaleAnimation.value,
                    child: Opacity(
                      opacity: _opacityAnimation.value,
                      child: Container(
                        width: 150,
                        height: 150,
                        decoration: BoxDecoration(
                          shape: BoxShape.circle,
                          border: Border.all(
                            color: VlvtColors.gold,
                            width: 2,
                          ),
                        ),
                      ),
                    ),
                  );
                },
              ),
              // Center icon
              Container(
                width: 80,
                height: 80,
                decoration: BoxDecoration(
                  shape: BoxShape.circle,
                  color: VlvtColors.gold.withOpacity(0.2),
                ),
                child: Icon(
                  Icons.nightlife,
                  size: 40,
                  color: VlvtColors.gold,
                ),
              ),
            ],
          ),
        ),
        const SizedBox(height: 24),
        Text(
          'Searching nearby...',
          style: VlvtTextStyles.h3,
        ),
        const SizedBox(height: 8),
        Text(
          '${widget.nearbyCount} ${widget.nearbyCount == 1 ? 'person' : 'people'} nearby',
          style: VlvtTextStyles.bodyMedium.copyWith(
            color: VlvtColors.textSecondary,
          ),
        ),
      ],
    );
  }
}
```

3. **session_expiry_banner.dart** - Warning banner:

```dart
/// Session Expiry Banner Widget
/// Shows warning when session is about to expire
library;

import 'package:flutter/material.dart';
import '../../theme/vlvt_colors.dart';
import '../../theme/vlvt_text_styles.dart';

class SessionExpiryBanner extends StatelessWidget {
  final int secondsRemaining;
  final VoidCallback? onExtend;

  const SessionExpiryBanner({
    super.key,
    required this.secondsRemaining,
    this.onExtend,
  });

  @override
  Widget build(BuildContext context) {
    final minutes = secondsRemaining ~/ 60;
    final seconds = secondsRemaining % 60;

    return Container(
      width: double.infinity,
      padding: const EdgeInsets.symmetric(horizontal: 16, vertical: 12),
      decoration: BoxDecoration(
        color: VlvtColors.crimson,
        boxShadow: [
          BoxShadow(
            color: VlvtColors.crimson.withOpacity(0.3),
            blurRadius: 8,
            offset: const Offset(0, 2),
          ),
        ],
      ),
      child: Row(
        children: [
          const Icon(
            Icons.warning_amber_rounded,
            color: Colors.white,
            size: 20,
          ),
          const SizedBox(width: 12),
          Expanded(
            child: Text(
              'Session ending in ${minutes}:${seconds.toString().padLeft(2, '0')}',
              style: VlvtTextStyles.labelMedium.copyWith(
                color: Colors.white,
                fontWeight: FontWeight.bold,
              ),
            ),
          ),
          if (onExtend != null)
            TextButton(
              onPressed: onExtend,
              child: const Text(
                'Extend',
                style: TextStyle(
                  color: Colors.white,
                  fontWeight: FontWeight.bold,
                ),
              ),
            ),
        ],
      ),
    );
  }
}
```
  </action>
  <verify>
    - `flutter analyze frontend/lib/widgets/after_hours/` shows no errors
    - All three widgets compile without errors
  </verify>
  <done>SessionTimer, SearchingAnimation, and SessionExpiryBanner widgets created</done>
</task>

<task type="auto">
  <name>Task 2a: Build inactive/setup UI for tab screen</name>
  <files>frontend/lib/screens/after_hours_tab_screen.dart</files>
  <action>
Replace the placeholder tab screen with state-driven UI. Start with the inactive state UI (setup flow):

```dart
/// After Hours Tab Screen
/// Entry point for After Hours mode with state-driven UI
library;

import 'package:flutter/material.dart';
import 'package:flutter/services.dart';
import 'package:provider/provider.dart';
import '../services/after_hours_service.dart';
import '../services/after_hours_profile_service.dart';
import '../services/location_service.dart';
import '../widgets/after_hours/session_timer.dart';
import '../widgets/after_hours/searching_animation.dart';
import '../widgets/after_hours/session_expiry_banner.dart';
import '../widgets/vlvt_button.dart';
import '../widgets/vlvt_loader.dart';
import '../theme/vlvt_colors.dart';
import '../theme/vlvt_text_styles.dart';
import 'after_hours_profile_screen.dart';
import 'after_hours_preferences_screen.dart';

class AfterHoursTabScreen extends StatefulWidget {
  const AfterHoursTabScreen({super.key});

  @override
  State<AfterHoursTabScreen> createState() => _AfterHoursTabScreenState();
}

class _AfterHoursTabScreenState extends State<AfterHoursTabScreen>
    with WidgetsBindingObserver {
  int _selectedDuration = 30; // minutes
  bool _isStarting = false;
  bool _isMatchCardShowing = false; // Track if match card modal is displayed

  @override
  void initState() {
    super.initState();
    WidgetsBinding.instance.addObserver(this);
    _loadSetupData();
  }

  @override
  void dispose() {
    WidgetsBinding.instance.removeObserver(this);
    super.dispose();
  }

  @override
  void didChangeAppLifecycleState(AppLifecycleState state) {
    if (state == AppLifecycleState.resumed) {
      // Refresh session status when app returns to foreground
      context.read<AfterHoursService>().refreshSessionStatus();
    }
  }

  Future<void> _loadSetupData() async {
    final profileService = context.read<AfterHoursProfileService>();
    await profileService.loadAll();
  }

  Future<void> _startSession() async {
    setState(() => _isStarting = true);

    try {
      final locationService = context.read<LocationService>();
      final afterHoursService = context.read<AfterHoursService>();

      // Get current location
      final position = await locationService.getCurrentPosition();
      if (position == null) {
        if (mounted) {
          ScaffoldMessenger.of(context).showSnackBar(
            const SnackBar(
              content: Text('Unable to get location. Please enable location services.'),
              backgroundColor: VlvtColors.error,
            ),
          );
        }
        setState(() => _isStarting = false);
        return;
      }

      // Start session
      await afterHoursService.startSession(
        durationMinutes: _selectedDuration,
        lat: position.latitude,
        lng: position.longitude,
      );

      HapticFeedback.mediumImpact();
    } catch (e) {
      if (mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(
            content: Text('Failed to start session: $e'),
            backgroundColor: VlvtColors.error,
          ),
        );
      }
    } finally {
      if (mounted) {
        setState(() => _isStarting = false);
      }
    }
  }

  Future<void> _endSession() async {
    final confirmed = await showDialog<bool>(
      context: context,
      builder: (context) => AlertDialog(
        title: const Text('End Session?'),
        content: const Text('Your After Hours session will end and any active chats will close.'),
        actions: [
          TextButton(
            onPressed: () => Navigator.pop(context, false),
            child: const Text('Cancel'),
          ),
          TextButton(
            onPressed: () => Navigator.pop(context, true),
            child: Text('End Session', style: TextStyle(color: VlvtColors.crimson)),
          ),
        ],
      ),
    );

    if (confirmed == true) {
      await context.read<AfterHoursService>().endSession();
    }
  }

  Widget _buildInactiveContent(AfterHoursProfileService profileService) {
    if (profileService.isLoading) {
      return const Center(child: VlvtLoader());
    }

    final profile = profileService.profile;
    final preferences = profileService.preferences;
    final isProfileComplete = profile?.isComplete ?? false;
    final isPrefsComplete = preferences?.isComplete ?? false;

    return SingleChildScrollView(
      padding: const EdgeInsets.all(16),
      child: Column(
        crossAxisAlignment: CrossAxisAlignment.stretch,
        children: [
          // Header
          Center(
            child: Column(
              children: [
                Icon(
                  Icons.nightlife,
                  size: 64,
                  color: VlvtColors.gold,
                ),
                const SizedBox(height: 16),
                Text(
                  'After Hours Mode',
                  style: VlvtTextStyles.h1,
                ),
                const SizedBox(height: 8),
                Text(
                  'Connect with people nearby right now',
                  style: VlvtTextStyles.bodyMedium.copyWith(
                    color: VlvtColors.textSecondary,
                  ),
                  textAlign: TextAlign.center,
                ),
              ],
            ),
          ),

          const SizedBox(height: 32),

          // Setup checklist
          _buildSetupItem(
            title: 'After Hours Profile',
            subtitle: isProfileComplete ? 'Complete' : 'Add photo and bio',
            isComplete: isProfileComplete,
            onTap: () => Navigator.push(
              context,
              MaterialPageRoute(builder: (_) => const AfterHoursProfileScreen()),
            ).then((_) => _loadSetupData()),
          ),

          const SizedBox(height: 12),

          _buildSetupItem(
            title: 'Matching Preferences',
            subtitle: isPrefsComplete ? 'Complete' : 'Set your preferences',
            isComplete: isPrefsComplete,
            onTap: () => Navigator.push(
              context,
              MaterialPageRoute(builder: (_) => const AfterHoursPreferencesScreen()),
            ).then((_) => _loadSetupData()),
          ),

          const SizedBox(height: 32),

          // Duration selector
          if (isProfileComplete && isPrefsComplete) ...[
            Text(
              'Session Duration',
              style: VlvtTextStyles.labelLarge,
            ),
            const SizedBox(height: 12),
            Row(
              children: [
                _buildDurationChip(15),
                const SizedBox(width: 8),
                _buildDurationChip(30),
                const SizedBox(width: 8),
                _buildDurationChip(60),
              ],
            ),

            const SizedBox(height: 32),

            // Start button
            VlvtButton.primary(
              label: _isStarting ? 'Starting...' : 'Start Session',
              onPressed: _isStarting ? null : _startSession,
              isLoading: _isStarting,
            ),

            const SizedBox(height: 16),

            Text(
              'Your location will be used to find nearby users. Location is fuzzed for privacy.',
              style: VlvtTextStyles.bodySmall.copyWith(
                color: VlvtColors.textMuted,
              ),
              textAlign: TextAlign.center,
            ),
          ],
        ],
      ),
    );
  }

  Widget _buildSetupItem({
    required String title,
    required String subtitle,
    required bool isComplete,
    required VoidCallback onTap,
  }) {
    return InkWell(
      onTap: onTap,
      borderRadius: BorderRadius.circular(12),
      child: Container(
        padding: const EdgeInsets.all(16),
        decoration: BoxDecoration(
          color: VlvtColors.surface,
          borderRadius: BorderRadius.circular(12),
          border: Border.all(
            color: isComplete ? VlvtColors.success : VlvtColors.border,
            width: 1,
          ),
        ),
        child: Row(
          children: [
            Container(
              width: 40,
              height: 40,
              decoration: BoxDecoration(
                shape: BoxShape.circle,
                color: isComplete
                    ? VlvtColors.success.withOpacity(0.2)
                    : VlvtColors.gold.withOpacity(0.2),
              ),
              child: Icon(
                isComplete ? Icons.check : Icons.edit,
                color: isComplete ? VlvtColors.success : VlvtColors.gold,
                size: 20,
              ),
            ),
            const SizedBox(width: 16),
            Expanded(
              child: Column(
                crossAxisAlignment: CrossAxisAlignment.start,
                children: [
                  Text(title, style: VlvtTextStyles.labelLarge),
                  Text(
                    subtitle,
                    style: VlvtTextStyles.bodySmall.copyWith(
                      color: isComplete ? VlvtColors.success : VlvtColors.textSecondary,
                    ),
                  ),
                ],
              ),
            ),
            Icon(
              Icons.chevron_right,
              color: VlvtColors.textMuted,
            ),
          ],
        ),
      ),
    );
  }

  Widget _buildDurationChip(int minutes) {
    final isSelected = _selectedDuration == minutes;
    return Expanded(
      child: InkWell(
        onTap: () => setState(() => _selectedDuration = minutes),
        borderRadius: BorderRadius.circular(8),
        child: Container(
          padding: const EdgeInsets.symmetric(vertical: 12),
          decoration: BoxDecoration(
            color: isSelected ? VlvtColors.gold : VlvtColors.surface,
            borderRadius: BorderRadius.circular(8),
            border: Border.all(
              color: isSelected ? VlvtColors.gold : VlvtColors.border,
            ),
          ),
          child: Text(
            '$minutes min',
            textAlign: TextAlign.center,
            style: TextStyle(
              fontFamily: 'Montserrat',
              fontWeight: FontWeight.w600,
              color: isSelected ? VlvtColors.textOnGold : VlvtColors.textPrimary,
            ),
          ),
        ),
      ),
    );
  }

  // Continued in Task 2b...
```

Note: The `_isMatchCardShowing` boolean flag is used to prevent showing duplicate match card modals (fixes the fragile ModalRoute pattern issue).
  </action>
  <verify>
    - File compiles (partial - Task 2b completes it)
    - Inactive state UI elements are defined
    - `_isMatchCardShowing` flag is declared
  </verify>
  <done>Inactive/setup UI created with profile checklist, duration selector, and start button</done>
</task>

<task type="auto">
  <name>Task 2b: Build active session UI states for tab screen</name>
  <files>frontend/lib/screens/after_hours_tab_screen.dart</files>
  <action>
Continue the AfterHoursTabScreen implementation with the active session states:

Add the following methods to complete the class (add after _buildDurationChip):

```dart
  Widget _buildExpiredContent() {
    return Center(
      child: Padding(
        padding: const EdgeInsets.all(32),
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            Icon(
              Icons.timer_off,
              size: 64,
              color: VlvtColors.textMuted,
            ),
            const SizedBox(height: 24),
            Text(
              'Session Ended',
              style: VlvtTextStyles.h2,
            ),
            const SizedBox(height: 8),
            Text(
              'Your After Hours session has expired.',
              style: VlvtTextStyles.bodyMedium.copyWith(
                color: VlvtColors.textSecondary,
              ),
              textAlign: TextAlign.center,
            ),
            const SizedBox(height: 32),
            VlvtButton.primary(
              label: 'Start New Session',
              onPressed: () {
                // Reset to inactive state to show setup screen
                // resetToInactive() is defined in AfterHoursService (Plan 06-01 Task 1)
                context.read<AfterHoursService>().resetToInactive();
              },
            ),
          ],
        ),
      ),
    );
  }

  Widget _buildStateContent(
    AfterHoursState state,
    AfterHoursProfileService profileService,
    AfterHoursService afterHoursService,
  ) {
    switch (state) {
      case AfterHoursState.inactive:
        return _buildInactiveContent(profileService);

      case AfterHoursState.activating:
        return const Center(child: VlvtLoader());

      case AfterHoursState.searching:
        return Center(
          child: SearchingAnimation(
            nearbyCount: afterHoursService.nearbyCount,
          ),
        );

      case AfterHoursState.matched:
        // Match card will be shown as overlay in Plan 04
        return Center(
          child: Column(
            mainAxisAlignment: MainAxisAlignment.center,
            children: [
              Icon(Icons.favorite, size: 64, color: VlvtColors.gold),
              const SizedBox(height: 16),
              Text('Match found!', style: VlvtTextStyles.h2),
            ],
          ),
        );

      case AfterHoursState.chatting:
        // Will navigate to chat screen in Plan 05
        return Center(
          child: Text('In chat...', style: VlvtTextStyles.bodyMedium),
        );

      case AfterHoursState.expiring:
        // Same as searching but with banner above
        return Center(
          child: SearchingAnimation(
            nearbyCount: afterHoursService.nearbyCount,
          ),
        );

      case AfterHoursState.expired:
        return _buildExpiredContent();
    }
  }

  @override
  Widget build(BuildContext context) {
    final afterHoursService = context.watch<AfterHoursService>();
    final profileService = context.watch<AfterHoursProfileService>();
    final state = afterHoursService.state;

    return Scaffold(
      backgroundColor: VlvtColors.background,
      appBar: AppBar(
        backgroundColor: VlvtColors.background,
        title: Text('After Hours', style: VlvtTextStyles.h2),
        actions: [
          if (afterHoursService.isSessionActive && afterHoursService.expiresAt != null)
            Padding(
              padding: const EdgeInsets.only(right: 8),
              child: Center(
                child: SessionTimer(
                  expiresAt: afterHoursService.expiresAt!,
                  onWarning: () {
                    HapticFeedback.heavyImpact();
                  },
                ),
              ),
            ),
          if (afterHoursService.isSessionActive)
            IconButton(
              icon: const Icon(Icons.stop_circle_outlined),
              onPressed: _endSession,
              tooltip: 'End Session',
            ),
        ],
      ),
      body: Column(
        children: [
          // Expiry warning banner
          if (state == AfterHoursState.expiring)
            SessionExpiryBanner(
              secondsRemaining: afterHoursService.remainingSeconds,
              onExtend: () {
                // TODO: Implement session extension in future
              },
            ),

          // Main content based on state
          Expanded(
            child: _buildStateContent(state, profileService, afterHoursService),
          ),
        ],
      ),
    );
  }
}
```

Key notes:
- The `_buildExpiredContent()` method calls `resetToInactive()` which is defined in AfterHoursService (Plan 06-01 Task 1)
- The `_isMatchCardShowing` flag is declared in Task 2a and will be used in Plan 06-04 for the match card modal
  </action>
  <verify>
    - `flutter analyze frontend/lib/screens/after_hours_tab_screen.dart` shows no errors
    - Run app, see setup checklist when profile/prefs incomplete
    - Complete profile and prefs, see duration selector and start button
    - Start session, see searching animation
  </verify>
  <done>After Hours tab screen shows complete flow from setup to searching with timer and widgets</done>
</task>

</tasks>

<verification>
1. `cd frontend && flutter analyze` - no errors
2. Open After Hours tab as premium user
3. See setup checklist (profile and preferences items)
4. Tap profile item - navigate to profile screen
5. Tap preferences item - navigate to preferences screen
6. Complete both - see duration selector appear
7. Select duration and start session
8. See searching animation with nearby count
9. Timer visible in app bar, counts down
10. End session via stop button - returns to inactive state
</verification>

<success_criteria>
- Setup checklist shows profile and preferences completion status
- Duration selector visible only when setup complete
- Start session triggers state transition to searching
- Searching animation shows with nearby count
- Timer widget displays in app bar during active session
- Session can be ended early with confirmation dialog
- Expiry banner appears in expiring state
- Expired state shows "Start New Session" button that calls resetToInactive()
</success_criteria>

<output>
After completion, create `.planning/phases/06-frontend-integration/06-03-SUMMARY.md`
</output>
