---
phase: 05-monitoring-alerting
plan: 04
type: execute
wave: 2
depends_on: ["05-02"]
files_modified:
  - .planning/docs/UPTIME-MONITORING.md
  - backend/shared/src/utils/logger.ts
autonomous: false
user_setup:
  - service: uptimerobot
    why: "Continuous external uptime monitoring for production endpoints"
    account: "Free tier (50 monitors, 5-min interval) at https://uptimerobot.com"
    dashboard_config:
      - task: "Create account and add monitors"
        location: "UptimeRobot Dashboard -> Add New Monitor"

must_haves:
  truths:
    - "UptimeRobot monitors all 3 production /health endpoints"
    - "Alerts are configured for downtime notification"
    - "PII redaction covers all SENSITIVE_FIELDS in logger"
    - "PII redaction audit confirms no leaks in production logs"
  artifacts:
    - path: ".planning/docs/UPTIME-MONITORING.md"
      provides: "Documentation of uptime monitoring configuration"
      contains: "UptimeRobot"
    - path: "backend/shared/src/utils/logger.ts"
      provides: "Verified PII redaction"
      contains: "SENSITIVE_FIELDS"
  key_links:
    - from: "UptimeRobot"
      to: "/health endpoints"
      via: "HTTP GET monitoring"
      pattern: "health"
---

<objective>
Configure external uptime monitoring and verify PII redaction in logs.

Purpose: Railway health checks only run at deploy time - continuous external monitoring is needed to detect downtime between deployments. PII redaction verification ensures SEC-07 compliance is maintained.

Output: UptimeRobot configuration documented, PII redaction audit completed with any gaps addressed.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-monitoring-alerting/05-RESEARCH.md
@backend/shared/src/utils/logger.ts - Existing PII redaction
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit PII redaction in logger</name>
  <files>backend/shared/src/utils/logger.ts</files>
  <action>
Review and verify the SENSITIVE_FIELDS array in logger.ts covers all PII categories:

**Current categories (verify present):**
1. Authentication/Secrets: token, password, apiKey, jwt, etc.
2. Location PII: latitude, longitude, coordinates, etc.
3. Message Content: text, content, body, chatMessage, etc.

**Check for missing fields that should be added (MON-06 verification):**
- `phone`, `phoneNumber`, `phone_number` - if phone auth is used
- `dob`, `dateOfBirth`, `date_of_birth`, `birthDate` - age verification data
- `ip`, `ipAddress`, `ip_address` - IP addresses are PII under GDPR
- `deviceId`, `device_id` - device identifiers
- `fcmToken`, `pushToken` - push notification tokens

**If any fields are missing, add them to SENSITIVE_FIELDS array:**
```typescript
const SENSITIVE_FIELDS = [
  // Authentication/Secrets (existing)
  'token', 'idToken', 'identityToken', 'authorization',
  // ... existing fields ...

  // Personal Identifiers (add if missing)
  'phone', 'phoneNumber', 'phone_number',
  'dob', 'dateOfBirth', 'date_of_birth', 'birthDate', 'birth_date',

  // Device/Network Identifiers (add if missing)
  'ip', 'ipAddress', 'ip_address', 'remoteAddress',
  'deviceId', 'device_id',
  'fcmToken', 'fcm_token', 'pushToken', 'push_token',

  // Location PII (existing)
  'latitude', 'longitude', 'lat', 'lng', 'location',
  // ... existing fields ...

  // Message Content (existing)
  'text', 'messageText', 'message_text',
  // ... existing fields ...
];
```

**Run a grep audit to find potential PII in logs:**
```bash
grep -r "logger\." backend/*/src/**/*.ts | grep -E "(phone|dob|birthDate|deviceId|fcmToken)"
```

If any PII is being logged that's not covered, either:
1. Add the field to SENSITIVE_FIELDS, or
2. Remove the logging of that field
  </action>
  <verify>
1. `cd backend/shared && npm run build` compiles
2. Review SENSITIVE_FIELDS array for completeness
3. `grep -rn "phone\|dob\|deviceId" backend/*/src/**/*.ts` to find any PII logging
  </verify>
  <done>
SENSITIVE_FIELDS covers all PII categories including phone, DOB, device IDs, and push tokens.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create uptime monitoring documentation</name>
  <files>.planning/docs/UPTIME-MONITORING.md</files>
  <action>
Create documentation for UptimeRobot configuration at `.planning/docs/UPTIME-MONITORING.md`:

```markdown
# Uptime Monitoring Configuration

## Overview

VLVT uses UptimeRobot for continuous external uptime monitoring. Railway's built-in health checks only run at deploy time, so external monitoring is required to detect downtime between deployments.

## Service: UptimeRobot

**Plan:** Free tier (50 monitors, 5-minute intervals)
**Dashboard:** https://uptimerobot.com/dashboard

## Monitors to Configure

### Production Endpoints

| Monitor Name | URL | Type | Interval |
|--------------|-----|------|----------|
| VLVT Auth Service | https://auth.vlvtapp.com/health | HTTP(s) | 5 min |
| VLVT Profile Service | https://profile.vlvtapp.com/health | HTTP(s) | 5 min |
| VLVT Chat Service | https://chat.vlvtapp.com/health | HTTP(s) | 5 min |

**Note:** Replace URLs with actual Railway production URLs if different.

### Alert Configuration

1. **Alert Contacts:** Add email address for downtime notifications
2. **Alert Threshold:** Alert after 2 consecutive failures (10 minutes)
3. **Recovery Alert:** Enable to know when service recovers

### Expected Health Response

```json
{
  "status": "ok",
  "service": "auth-service",
  "timestamp": "2026-01-25T12:00:00.000Z",
  "checks": {
    "database": {
      "status": "ok",
      "latencyMs": 5
    }
  },
  "version": { ... }
}
```

### Interpreting Results

| Status Code | Meaning | Action |
|-------------|---------|--------|
| 200 | Healthy | None |
| 503 | Degraded (dependency down) | Check database connectivity |
| 5xx | Service error | Check Railway logs |
| Timeout | Service unreachable | Check Railway deployment status |

## Setup Steps

1. Create account at https://uptimerobot.com (free)
2. Add New Monitor for each service:
   - Type: HTTP(s)
   - Friendly Name: VLVT [Service] Service
   - URL: [production URL]/health
   - Monitoring Interval: 5 minutes
3. Configure alert contacts (email)
4. Save and verify monitors are showing UP

## Railway Production URLs

Get production URLs from Railway dashboard:
- Auth Service: `railway service auth-service domain`
- Profile Service: `railway service profile-service domain`
- Chat Service: `railway service chat-service domain`

Or check Railway dashboard -> Service -> Settings -> Networking -> Public Domain
```

**Note:** This is documentation only. The actual UptimeRobot configuration will be done by the user during the checkpoint.
  </action>
  <verify>
File `.planning/docs/UPTIME-MONITORING.md` exists and contains:
- UptimeRobot setup instructions
- Monitor configuration table
- Alert configuration guidance
- Expected health response format
  </verify>
  <done>
Uptime monitoring documentation created with UptimeRobot configuration guide.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
External uptime monitoring documentation and PII redaction audit completed.
  </what-built>
  <how-to-verify>
1. **PII Redaction Verification:**
   - Review the SENSITIVE_FIELDS array in `backend/shared/src/utils/logger.ts`
   - Confirm all PII categories are covered
   - Run one of the services locally and check logs don't contain PII

2. **UptimeRobot Configuration:**
   - Go to https://uptimerobot.com and create a free account
   - Add monitors for each production /health endpoint:
     - Auth Service: [Railway URL]/health
     - Profile Service: [Railway URL]/health
     - Chat Service: [Railway URL]/health
   - Configure email alerts for downtime
   - Verify monitors show "UP" status

3. **Test Health Endpoints:**
   - `curl [auth-service-url]/health` returns JSON with database check
   - `curl [profile-service-url]/health` returns JSON with database check
   - `curl [chat-service-url]/health` returns JSON with database check
  </how-to-verify>
  <resume-signal>
Type "verified" after:
- UptimeRobot monitors configured for all 3 services
- All monitors showing UP status
- Email alerts configured for downtime notification
  </resume-signal>
</task>

</tasks>

<verification>
1. SENSITIVE_FIELDS array covers all PII categories
2. `npm run build` in shared package compiles
3. `.planning/docs/UPTIME-MONITORING.md` exists with configuration guide
4. User confirms UptimeRobot monitors configured and showing UP
</verification>

<success_criteria>
- PII redaction audit complete - all categories covered
- Uptime monitoring documentation created
- UptimeRobot monitors configured for all 3 production endpoints
- Monitors showing UP status
- Downtime alerts configured via email
</success_criteria>

<output>
After completion, create `.planning/phases/05-monitoring-alerting/05-04-SUMMARY.md`
</output>
