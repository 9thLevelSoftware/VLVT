---
phase: 02-gdpr-compliance
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/lib/screens/safety_settings_screen.dart
  - frontend/assets/legal/privacy_policy.md
  - docs/DATA_RETENTION.md
autonomous: true

must_haves:
  truths:
    - "Privacy policy is accessible from Safety & Privacy settings screen"
    - "Privacy policy contains explicit disclosure about sexual orientation inference"
    - "Data retention periods are documented for all data categories"
  artifacts:
    - path: "frontend/lib/screens/safety_settings_screen.dart"
      provides: "Privacy policy link in Settings"
      contains: "LegalDocumentViewer"
    - path: "frontend/assets/legal/privacy_policy.md"
      provides: "Special category data disclosure"
      contains: "sexual orientation"
    - path: "docs/DATA_RETENTION.md"
      provides: "Data retention documentation"
      contains: "retention period"
  key_links:
    - from: "frontend/lib/screens/safety_settings_screen.dart"
      to: "LegalDocumentViewer"
      via: "Navigator.push"
      pattern: "Navigator.*LegalDocumentViewer"
---

<objective>
Add privacy policy access and document data retention policies

Purpose: Satisfy GDPR-01, GDPR-06, GDPR-07 requirements. Users must be able to access the privacy policy from Settings, understand how long their data is retained, and be informed about special category data processing (sexual orientation inference from After Hours).

Output: Privacy policy link in Settings, updated privacy policy with Article 9 disclosure, data retention documentation.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-gdpr-compliance/02-RESEARCH.md

# Existing files to modify
@frontend/lib/screens/safety_settings_screen.dart
@frontend/assets/legal/privacy_policy.md
@frontend/lib/screens/legal_document_viewer.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add privacy policy link to Safety Settings screen</name>
  <files>frontend/lib/screens/safety_settings_screen.dart</files>
  <action>
Add a new section in the SafetySettingsScreen ListView for "Privacy & Legal" before the "Delete Account" section.

Add these ListTile widgets:
1. "Privacy Policy" - navigates to LegalDocumentViewer with privacyPolicy.md
2. "Terms of Service" - navigates to LegalDocumentViewer with termsOfService.md

Import the LegalDocumentViewer if not already imported:
```dart
import 'legal_document_viewer.dart';
```

The navigation should be:
```dart
Navigator.push(
  context,
  MaterialPageRoute(
    builder: (context) => const LegalDocumentViewer(
      title: 'Privacy Policy',
      assetPath: 'assets/legal/privacy_policy.md',
    ),
  ),
);
```

Use standard ListTile with trailing chevron icon (Icons.chevron_right) to indicate navigation.
  </action>
  <verify>Run `flutter analyze frontend` - no errors related to safety_settings_screen.dart</verify>
  <done>Privacy Policy and Terms of Service links appear in Safety Settings screen before Delete Account section</done>
</task>

<task type="auto">
  <name>Task 2: Update privacy policy with special category data disclosure</name>
  <files>frontend/assets/legal/privacy_policy.md</files>
  <action>
Update Section 12 (GDPR) of the privacy policy to explicitly disclose special category data processing under Article 9.

Add a new subsection under Section 12 titled "12.X Special Category Data (Article 9)" with:

1. Explicit statement that After Hours Mode may reveal sexual orientation through:
   - User's gender + seeking_gender preference combination
   - Participation in features designed for adult dating

2. Legal basis: Explicit consent (user must enable After Hours Mode and grant consent)

3. Processing safeguards:
   - Data is encrypted at rest (KYCAID encryption from Phase 1)
   - Access limited to premium, ID-verified users
   - Ephemeral matching with auto-deletion
   - User can withdraw consent at any time

4. User rights: Users can disable After Hours Mode and withdraw consent without affecting regular app usage

Keep the existing GDPR section structure intact. Add this as a new subsection.
  </action>
  <verify>Read the updated privacy_policy.md and confirm Section 12 contains "sexual orientation" and "Article 9"</verify>
  <done>Privacy policy contains explicit Article 9 disclosure about sexual orientation inference from After Hours Mode</done>
</task>

<task type="auto">
  <name>Task 3: Create data retention documentation</name>
  <files>docs/DATA_RETENTION.md</files>
  <action>
Create a comprehensive data retention policy document. This is internal documentation (not user-facing).

Document retention periods for each data category:

| Category | Data | Retention Period | Deletion Method |
|----------|------|------------------|-----------------|
| Core Identity | users table | Until account deletion | CASCADE |
| Profile | profiles table | Until account deletion | CASCADE |
| Photos | R2 storage | Until account deletion | deleteUserPhotos() |
| Messages | messages table | 30 days after unmatch OR account deletion | CASCADE |
| After Hours | after_hours_* | Session expiry (1 hour) + 30 days safety retention | CASCADE |
| Verification | kycaid_verifications | Until account deletion | CASCADE |
| Audit Logs | audit_log | 7 years (legal compliance) | NOT deleted with user |
| Login Attempts | login_attempts | 30 days | AUTO cleanup job |

Document the legal basis for each retention period:
- User data: Contract performance (user requested service)
- Messages: Legitimate interest (safety/moderation)
- Audit logs: Legal obligation (compliance)

Include the CASCADE dependency tree showing what happens when users row is deleted.
  </action>
  <verify>File exists at docs/DATA_RETENTION.md with all data categories documented</verify>
  <done>Data retention documentation exists with retention periods and legal basis for all data categories</done>
</task>

</tasks>

<verification>
1. Run `flutter analyze frontend` - no new errors
2. Read safety_settings_screen.dart - contains LegalDocumentViewer navigation
3. Read privacy_policy.md Section 12 - contains Article 9 disclosure
4. Read docs/DATA_RETENTION.md - all data categories documented
</verification>

<success_criteria>
- Privacy Policy link visible in Safety & Privacy settings screen
- Privacy policy Section 12 includes special category data disclosure (Article 9)
- Data retention documentation exists with all categories and legal basis
- No Flutter analyze errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-gdpr-compliance/02-01-SUMMARY.md`
</output>
