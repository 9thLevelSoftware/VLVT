---
phase: 11-tooltip-accessibility-ops-readiness
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/lib/widgets/vlvt_button.dart
  - frontend/lib/screens/after_hours_chat_screen.dart
  - frontend/lib/screens/after_hours_preferences_screen.dart
  - frontend/lib/screens/after_hours_profile_screen.dart
  - frontend/lib/screens/chat_screen.dart
  - frontend/lib/screens/forgot_password_screen.dart
  - frontend/lib/screens/id_verification_screen.dart
  - frontend/lib/screens/invite_screen.dart
  - frontend/lib/screens/paywall_screen.dart
  - frontend/lib/screens/profile_detail_screen.dart
  - frontend/lib/screens/profile_edit_screen.dart
  - frontend/lib/screens/verification_screen.dart
  - frontend/lib/widgets/feedback_widget.dart
autonomous: true
requirements: [A11Y-01, A11Y-02, A11Y-03]

must_haves:
  truths:
    - "VlvtIconButton accepts a tooltip parameter and passes it to IconButton.tooltip (non-outlined) or Semantics.label (outlined)"
    - "VlvtIconButton non-outlined variant does NOT wrap IconButton in a Semantics widget (prevents duplicate screen reader announcements)"
    - "Every IconButton in the app has a descriptive tooltip property set"
    - "No icon button produces duplicate screen reader announcements from overlapping Semantics wrappers and tooltip properties"
  artifacts:
    - path: "frontend/lib/widgets/vlvt_button.dart"
      provides: "VlvtIconButton with tooltip parameter"
      contains: "String? tooltip"
    - path: "frontend/lib/screens/after_hours_chat_screen.dart"
      provides: "Send message tooltip on chat input send button"
      contains: "tooltip: 'Send message'"
    - path: "frontend/lib/screens/paywall_screen.dart"
      provides: "Go back and Sign out tooltips"
      contains: "tooltip: 'Go back'"
    - path: "frontend/lib/widgets/feedback_widget.dart"
      provides: "Close and star rating tooltips"
      contains: "tooltip: 'Close'"
  key_links:
    - from: "frontend/lib/widgets/vlvt_button.dart"
      to: "IconButton.tooltip"
      via: "tooltip parameter passthrough"
      pattern: "tooltip: tooltip"
    - from: "frontend/lib/widgets/vlvt_button.dart"
      to: "Semantics.label"
      via: "outlined variant label passthrough"
      pattern: "label: tooltip"
---

<objective>
Add tooltip accessibility to VlvtIconButton and all raw IconButton instances across the app so screen readers announce descriptive actions for every icon button.

Purpose: Screen reader users (TalkBack on Android, VoiceOver on iOS) currently hear "button" with no description for 18 icon buttons. This makes the app unusable for visually impaired users.
Output: VlvtIconButton widget with tooltip parameter; all 18 missing tooltips added to raw IconButtons.
</objective>

<execution_context>
@C:/Users/dasbl/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/dasbl/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-tooltip-accessibility-ops-readiness/11-RESEARCH.md

@frontend/lib/widgets/vlvt_button.dart

<interfaces>
<!-- Current VlvtIconButton (lines 306-363 of vlvt_button.dart) -->
<!-- The non-outlined variant wraps IconButton in Semantics(button: true) -- this causes duplicate announcements -->
<!-- The outlined variant uses GestureDetector with Semantics(button: true) but no label -->

From frontend/lib/widgets/vlvt_button.dart (current):
```dart
class VlvtIconButton extends StatelessWidget {
  final IconData icon;
  final VoidCallback? onPressed;
  final Color? color;
  final double size;
  final bool outlined;
  // NO tooltip parameter currently
}
```

Flutter IconButton API (SDK):
```dart
// IconButton.tooltip provides both visual tooltip AND semantic label
// Do NOT also wrap in Semantics -- creates duplicate announcements
IconButton(
  icon: Icon(Icons.send),
  onPressed: callback,
  tooltip: 'Send message',  // Screen reader: "Send message, button"
)
```
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Refactor VlvtIconButton to accept tooltip and fix duplicate Semantics</name>
  <files>frontend/lib/widgets/vlvt_button.dart</files>
  <action>
Modify the `VlvtIconButton` class (starts at line 306) in `vlvt_button.dart`:

1. Add `final String? tooltip;` field to the class
2. Add `this.tooltip,` to the constructor parameters
3. **Non-outlined variant (the `else` branch, currently lines 352-361):** Remove the `Semantics(button: true, enabled: onPressed != null, child: ...)` wrapper entirely. Return the `IconButton` directly with `tooltip: tooltip` added. The `IconButton` handles its own semantics via the tooltip property -- wrapping it in `Semantics` causes TalkBack to announce the button twice (Flutter issues #147045, #148167).
4. **Outlined variant (the `if (outlined)` branch, currently lines 327-349):** Keep the `Semantics` wrapper (GestureDetector has no built-in tooltip) but add `label: tooltip,` to the Semantics widget. This is the ONLY way to give GestureDetector-based widgets a screen reader label.

The refactored VlvtIconButton should look like:

```dart
class VlvtIconButton extends StatelessWidget {
  final IconData icon;
  final VoidCallback? onPressed;
  final Color? color;
  final double size;
  final bool outlined;
  final String? tooltip;

  const VlvtIconButton({
    super.key,
    required this.icon,
    this.onPressed,
    this.color,
    this.size = 24,
    this.outlined = false,
    this.tooltip,
  });

  @override
  Widget build(BuildContext context) {
    final iconColor = color ?? VlvtColors.gold;

    if (outlined) {
      return Semantics(
        label: tooltip,
        button: true,
        enabled: onPressed != null,
        child: GestureDetector(
          onTap: onPressed,
          child: Container(
            width: size + 20,
            height: size + 20,
            decoration: BoxDecoration(
              shape: BoxShape.circle,
              border: Border.all(
                color: iconColor.withValues(alpha: 0.5),
                width: 1.5,
              ),
            ),
            child: Icon(
              icon,
              size: size,
              color: iconColor,
            ),
          ),
        ),
      );
    }

    // No Semantics wrapper -- IconButton handles its own via tooltip
    return IconButton(
      onPressed: onPressed,
      icon: Icon(icon),
      iconSize: size,
      color: iconColor,
      tooltip: tooltip,
    );
  }
}
```

IMPORTANT: Do NOT touch the `VlvtButton` class above VlvtIconButton in the same file. Only modify VlvtIconButton.
  </action>
  <verify>
    <automated>cd "C:/Users/dasbl/AndroidStudioProjects/VLVT/frontend" && flutter analyze --no-fatal-infos 2>&1 | tail -5</automated>
  </verify>
  <done>VlvtIconButton has a `tooltip` parameter. Non-outlined variant returns bare IconButton with tooltip (no Semantics wrapper). Outlined variant has Semantics(label: tooltip). flutter analyze passes with no new errors.</done>
</task>

<task type="auto">
  <name>Task 2: Add tooltips to all 18 IconButtons missing descriptive labels</name>
  <files>
    frontend/lib/screens/after_hours_chat_screen.dart
    frontend/lib/screens/after_hours_preferences_screen.dart
    frontend/lib/screens/after_hours_profile_screen.dart
    frontend/lib/screens/chat_screen.dart
    frontend/lib/screens/forgot_password_screen.dart
    frontend/lib/screens/id_verification_screen.dart
    frontend/lib/screens/invite_screen.dart
    frontend/lib/screens/paywall_screen.dart
    frontend/lib/screens/profile_detail_screen.dart
    frontend/lib/screens/profile_edit_screen.dart
    frontend/lib/screens/verification_screen.dart
    frontend/lib/widgets/feedback_widget.dart
  </files>
  <action>
Add `tooltip:` property to each IconButton listed below. Do NOT add "button" to tooltip text (screen readers already append "button"). Do NOT wrap any IconButton in a Semantics widget. Do NOT change IconButtons that already have tooltips.

Exact locations and tooltip values:

1. **after_hours_chat_screen.dart ~line 894** — send icon in chat input
   `tooltip: 'Send message'`

2. **after_hours_preferences_screen.dart ~line 210** — close icon in AppBar leading
   `tooltip: 'Close'`

3. **after_hours_profile_screen.dart ~line 380** — close icon in AppBar leading
   `tooltip: 'Close'`

4. **chat_screen.dart ~line 1120** — send icon in chat input
   `tooltip: 'Send message'`

5. **feedback_widget.dart ~line 207** — close icon on feedback dialog
   `tooltip: 'Close'`

6. **feedback_widget.dart ~line 269** — star icons (dynamically generated in a loop). Add dynamic tooltip:
   `tooltip: 'Rate $i star${i == 1 ? "" : "s"}'`
   where `i` is the star number variable in the loop (1-based index)

7. **forgot_password_screen.dart ~line 150** — arrow_back icon
   `tooltip: 'Go back'`

8. **id_verification_screen.dart ~line 249** — close icon in AppBar leading
   `tooltip: 'Close verification'`

9. **invite_screen.dart ~line 373** — share icon
   `tooltip: 'Share invite code'`

10. **paywall_screen.dart ~line 74** — arrow_back icon (first instance, in AppBar)
    `tooltip: 'Go back'`

11. **paywall_screen.dart ~line 453** — arrow_back icon (second instance, alternate AppBar)
    `tooltip: 'Go back'`

12. **paywall_screen.dart ~line 460** — logout icon
    `tooltip: 'Sign out'`

13. **profile_detail_screen.dart ~line 184** — arrow_back icon in AppBar leading
    `tooltip: 'Go back'`

14. **profile_edit_screen.dart ~line 298** — close icon in AppBar leading
    `tooltip: 'Discard changes'`

15. **verification_screen.dart ~line 183** — close icon in AppBar leading
    `tooltip: 'Close verification'`

For each IconButton, add `tooltip: '...',` as a named parameter. Example transformation:

BEFORE:
```dart
IconButton(
  icon: const Icon(Icons.send),
  onPressed: _sendMessage,
)
```

AFTER:
```dart
IconButton(
  icon: const Icon(Icons.send),
  onPressed: _sendMessage,
  tooltip: 'Send message',
)
```

NOTE on auth_screen.dart: The OAuth buttons use custom `Semantics + GestureDetector` and already have correct semantic labels ("Sign in with Google", "Sign in with Apple"). Do NOT modify them.
  </action>
  <verify>
    <automated>cd "C:/Users/dasbl/AndroidStudioProjects/VLVT/frontend" && flutter analyze --no-fatal-infos 2>&1 | tail -5 && flutter test 2>&1 | tail -10</automated>
  </verify>
  <done>All 18 previously-unlabeled IconButtons now have descriptive tooltip properties. flutter analyze passes. flutter test passes (no regressions).</done>
</task>

</tasks>

<verification>
1. `flutter analyze --no-fatal-infos` passes with no new errors
2. `flutter test` passes (no regressions from Semantics wrapper removal or tooltip additions)
3. Every `IconButton(` instance in `frontend/lib/` has a `tooltip:` property (verify with: `grep -rn 'IconButton(' frontend/lib/ --include='*.dart' | grep -v tooltip | grep -v _buildOAuth | grep -v vlvt_button.dart`)
4. VlvtIconButton non-outlined variant does NOT have a Semantics wrapper (verify by reading vlvt_button.dart)
5. VlvtIconButton outlined variant has `Semantics(label: tooltip,` in its widget tree
</verification>

<success_criteria>
- VlvtIconButton widget accepts `tooltip` parameter (A11Y-01)
- All IconButtons across the app have descriptive tooltips (A11Y-02) -- verified by grep showing zero IconButton instances without tooltip (excluding auth OAuth buttons)
- No Semantics wrapper around non-outlined VlvtIconButton (A11Y-03) -- duplicate announcement prevention
- flutter analyze and flutter test both pass
</success_criteria>

<output>
After completion, create `.planning/phases/11-tooltip-accessibility-ops-readiness/11-01-SUMMARY.md`
</output>
