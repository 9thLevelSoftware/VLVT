---
phase: 10-page-transitions
plan: 02
type: execute
wave: 2
depends_on:
  - "10-01"
files_modified:
  - frontend/lib/screens/chats_screen.dart
  - frontend/lib/screens/chat_screen.dart
  - frontend/lib/screens/discovery_screen.dart
  - frontend/lib/screens/matches_screen.dart
  - frontend/lib/screens/profile_screen.dart
  - frontend/lib/screens/after_hours_tab_screen.dart
  - frontend/lib/screens/safety_settings_screen.dart
autonomous: true
requirements:
  - UX-03
  - UX-04
must_haves:
  truths:
    - "Every screen navigation in the app uses VlvtPageRoute or VlvtFadeRoute -- zero MaterialPageRoute or inline PageRouteBuilder calls remain"
    - "Hero animations on discovery profile cards and chat screen avatars continue to fly correctly during slide-from-right transitions"
    - "After Hours screens continue to use fade transitions (now via VlvtFadeRoute instead of inline PageRouteBuilder)"
    - "Legal document screens in safety settings use crossfade transitions (VlvtFadeRoute) instead of the prior slide-from-bottom"
  artifacts:
    - path: "frontend/lib/screens/chats_screen.dart"
      provides: "Updated navigation to ChatScreen using VlvtPageRoute<bool>"
    - path: "frontend/lib/screens/chat_screen.dart"
      provides: "Updated navigation to ProfileEditScreen using VlvtPageRoute"
    - path: "frontend/lib/screens/discovery_screen.dart"
      provides: "Updated navigation using VlvtFadeRoute and VlvtPageRoute, consolidated inline PageRouteBuilder"
    - path: "frontend/lib/screens/matches_screen.dart"
      provides: "Updated navigation to ChatScreen and ProfileDetailScreen using VlvtPageRoute"
    - path: "frontend/lib/screens/profile_screen.dart"
      provides: "Updated navigation using VlvtPageRoute, consolidated inline PageRouteBuilder"
    - path: "frontend/lib/screens/after_hours_tab_screen.dart"
      provides: "4 inline PageRouteBuilder calls consolidated to VlvtFadeRoute"
    - path: "frontend/lib/screens/safety_settings_screen.dart"
      provides: "3 inline PageRouteBuilder calls consolidated to VlvtFadeRoute"
  key_links:
    - from: "frontend/lib/screens/discovery_screen.dart"
      to: "frontend/lib/screens/matches_screen.dart"
      via: "Hero tag for profile card images"
      pattern: "HeroTags\\."
    - from: "frontend/lib/screens/chats_screen.dart"
      to: "frontend/lib/screens/chat_screen.dart"
      via: "Hero tag for chat avatars"
      pattern: "HeroTags\\."
---

<objective>
Replace all remaining MaterialPageRoute calls (10) and consolidate all inline PageRouteBuilder calls (10) across the core screen files, completing the full migration to VlvtPageRoute and VlvtFadeRoute.

Purpose: Achieve 100% coverage — zero remaining default transitions — and verify Hero animations still work with the custom routes.

Output: 7 screen files updated; zero MaterialPageRoute or inline PageRouteBuilder calls in the codebase.
</objective>

<execution_context>
@C:/Users/dasbl/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/dasbl/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-page-transitions/10-RESEARCH.md
@.planning/phases/10-page-transitions/10-01-SUMMARY.md

@frontend/lib/utils/vlvt_routes.dart
@frontend/lib/screens/chats_screen.dart
@frontend/lib/screens/chat_screen.dart
@frontend/lib/screens/discovery_screen.dart
@frontend/lib/screens/matches_screen.dart
@frontend/lib/screens/profile_screen.dart
@frontend/lib/screens/after_hours_tab_screen.dart
@frontend/lib/screens/safety_settings_screen.dart

<interfaces>
<!-- From Plan 10-01 (vlvt_routes.dart): -->
<!--
import 'package:vlvt/utils/vlvt_routes.dart';

class VlvtPageRoute<T> extends PageRouteBuilder<T> {
  VlvtPageRoute({required Widget Function(BuildContext) builder, ...});
}

class VlvtFadeRoute<T> extends PageRouteBuilder<T> {
  VlvtFadeRoute({required Widget Function(BuildContext) builder, ...});
}
-->
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace MaterialPageRoute in chat, discovery, and matches screens</name>
  <files>
frontend/lib/screens/chats_screen.dart
frontend/lib/screens/chat_screen.dart
frontend/lib/screens/discovery_screen.dart
frontend/lib/screens/matches_screen.dart
  </files>
  <action>
Add `import 'package:vlvt/utils/vlvt_routes.dart';` to each file. Replace MaterialPageRoute calls AND consolidate inline PageRouteBuilder calls as follows:

**chats_screen.dart (1 MaterialPageRoute):**
1. Line ~556: `MaterialPageRoute(builder: (context) => ChatScreen(...))` → `VlvtPageRoute<bool>(builder: (_) => ChatScreen(...))` — note this uses `Navigator.push<bool>`, preserve the generic type parameter.

**chat_screen.dart (2 MaterialPageRoute):**
2. Line ~345: `MaterialPageRoute(builder: (context) => ProfileEditScreen(...))` → `VlvtPageRoute(builder: (_) => ProfileEditScreen(...))`
3. Line ~782: `MaterialPageRoute(builder: (context) => ProfileEditScreen(...))` → `VlvtPageRoute(builder: (_) => ProfileEditScreen(...))`

**discovery_screen.dart (2 MaterialPageRoute + 1 inline PageRouteBuilder):**
4. Line ~670: `MaterialPageRoute(builder: (context) => DiscoveryFiltersScreen(...))` → `VlvtFadeRoute(builder: (_) => DiscoveryFiltersScreen(...))` — filter overlay is modal-style
5. Line ~701: `MaterialPageRoute(builder: (context) => ProfileDetailScreen(...))` → `VlvtPageRoute(builder: (_) => ProfileDetailScreen(...))` — forward navigation
6. Line ~946: Inline `PageRouteBuilder<void>` with FadeTransition to MatchesScreen → `VlvtFadeRoute<void>(builder: (_) => MatchesScreen(...))`

**matches_screen.dart (3 MaterialPageRoute):**
7. Line ~671: `MaterialPageRoute(builder: (context) => ChatScreen(...))` → `VlvtPageRoute<bool>(builder: (_) => ChatScreen(...))` — preserves `Navigator.push<bool>` return type
8. Line ~683: `MaterialPageRoute(builder: (context) => ProfileDetailScreen(...))` → `VlvtPageRoute<bool>(builder: (_) => ProfileDetailScreen(...))` — preserves `Navigator.push<bool>` return type
9. Line ~712: `MaterialPageRoute(builder: (context) => ProfileDetailScreen(...))` → `VlvtPageRoute(builder: (_) => ProfileDetailScreen(...))`

HERO ANIMATION PRESERVATION:
- `discovery_screen.dart` line ~701 navigates to ProfileDetailScreen with Hero tags for profile card images. VlvtPageRoute keeps `opaque: true` (default), so Hero flight animations work without changes.
- `chats_screen.dart` and `chat_screen.dart` use Hero tags for chat avatars. Same applies — VlvtPageRoute is Hero-compatible.
- Do NOT modify any Hero widget code — only the Route class changes.

IMPORTANT:
- Preserve all Navigator method calls (push, push<bool>, etc.) — only the Route constructor changes.
- Preserve all constructor arguments passed to destination screens.
- Remove the `context` parameter name in builder callback — use `_` since it's unused.
- For discovery_screen.dart line ~946, remove the entire inline PageRouteBuilder (including `pageBuilder`, `transitionsBuilder`, FadeTransition wrapper) and replace with the one-liner VlvtFadeRoute.
  </action>
  <verify>
    <automated>cd "C:/Users/dasbl/AndroidStudioProjects/VLVT/frontend" && flutter analyze lib/screens/chats_screen.dart lib/screens/chat_screen.dart lib/screens/discovery_screen.dart lib/screens/matches_screen.dart 2>&1 | tail -10</automated>
  </verify>
  <done>
10 navigation calls replaced/consolidated across 4 files. `flutter analyze` passes with no errors. `grep -rn "MaterialPageRoute" frontend/lib/screens/chats_screen.dart frontend/lib/screens/chat_screen.dart frontend/lib/screens/discovery_screen.dart frontend/lib/screens/matches_screen.dart` returns zero results.
  </done>
</task>

<task type="auto">
  <name>Task 2: Consolidate inline PageRouteBuilder in profile, after-hours, and safety screens</name>
  <files>
frontend/lib/screens/profile_screen.dart
frontend/lib/screens/after_hours_tab_screen.dart
frontend/lib/screens/safety_settings_screen.dart
  </files>
  <action>
Add `import 'package:vlvt/utils/vlvt_routes.dart';` to each file (if not already present). Replace remaining MaterialPageRoute AND consolidate all inline PageRouteBuilder calls:

**profile_screen.dart (2 MaterialPageRoute + 2 inline PageRouteBuilder):**
1. Line ~92: `MaterialPageRoute(builder: (context) => ProfileEditScreen(...))` → `VlvtPageRoute(builder: (_) => ProfileEditScreen(...))` — preserves `Navigator.push<Profile>` return type if present
2. Line ~481: `MaterialPageRoute(builder: (context) => IdVerificationScreen())` → `VlvtPageRoute(builder: (_) => const IdVerificationScreen())`
3. Line ~354: Inline `PageRouteBuilder` with SlideTransition (right) to SafetySettingsScreen → `VlvtPageRoute(builder: (_) => const SafetySettingsScreen())`
4. Line ~380: Inline `PageRouteBuilder` with SlideTransition (right) to InviteScreen → `VlvtPageRoute(builder: (_) => const InviteScreen())`

**after_hours_tab_screen.dart (4 inline PageRouteBuilder):**
5. Line ~169: Inline `PageRouteBuilder<void>` with FadeTransition to AfterHoursChatScreen → `VlvtFadeRoute<void>(builder: (_) => AfterHoursChatScreen(...))`
6. Line ~322: Inline `PageRouteBuilder` with FadeTransition to AfterHoursProfileScreen → `VlvtFadeRoute(builder: (_) => AfterHoursProfileScreen(...))`
7. Line ~340: Inline `PageRouteBuilder` with FadeTransition to AfterHoursPreferencesScreen → `VlvtFadeRoute(builder: (_) => const AfterHoursPreferencesScreen())`
8. Line ~579: Inline `PageRouteBuilder<void>` with FadeTransition to AfterHoursChatScreen → `VlvtFadeRoute<void>(builder: (_) => AfterHoursChatScreen(...))`

**safety_settings_screen.dart (3 inline PageRouteBuilder):**
9. Line ~443: Inline `PageRouteBuilder` with SlideTransition (bottom) to LegalDocumentViewer (Privacy Policy) → `VlvtFadeRoute(builder: (_) => LegalDocumentViewer(...))` — legal docs are modal/overlay content
10. Line ~472: Inline `PageRouteBuilder` with SlideTransition (bottom) to ConsentSettingsScreen → `VlvtFadeRoute(builder: (_) => const ConsentSettingsScreen())`
11. Line ~499: Inline `PageRouteBuilder` with SlideTransition (bottom) to LegalDocumentViewer (Terms of Service) → `VlvtFadeRoute(builder: (_) => LegalDocumentViewer(...))` — legal docs are modal/overlay content

For each inline PageRouteBuilder replacement:
- Remove the entire `PageRouteBuilder(pageBuilder: ..., transitionsBuilder: ...)` block (typically 8-12 lines).
- Replace with the one-liner VlvtFadeRoute or VlvtPageRoute call (1-2 lines).
- Preserve the generic type parameter if present (e.g., `PageRouteBuilder<void>` → `VlvtFadeRoute<void>`).
- Preserve all constructor arguments passed to the destination screen.

After all replacements, check for UNUSED IMPORTS in each file:
- If `SlideTransition`, `Tween`, `CurvedAnimation`, `Offset`, or `FadeTransition` were only used in the removed inline PageRouteBuilder blocks, remove those imports.
- The `PageRouteBuilder` import from `package:flutter/material.dart` is part of the material barrel export, so it won't be a separate import to remove.
  </action>
  <verify>
    <automated>cd "C:/Users/dasbl/AndroidStudioProjects/VLVT/frontend" && flutter analyze lib/screens/profile_screen.dart lib/screens/after_hours_tab_screen.dart lib/screens/safety_settings_screen.dart 2>&1 | tail -10</automated>
  </verify>
  <done>
11 navigation calls replaced/consolidated across 3 files. `flutter analyze` passes with no errors. Zero inline PageRouteBuilder calls remain in these files.
  </done>
</task>

<task type="auto">
  <name>Task 3: Final sweep verification — zero remaining default transitions</name>
  <files>
frontend/lib/utils/vlvt_routes.dart
  </files>
  <action>
Run a comprehensive verification sweep to confirm UX-03 (all MaterialPageRoute replaced) and UX-04 (Hero animations intact):

1. **MaterialPageRoute sweep:**
   Run `grep -rn "MaterialPageRoute" frontend/lib/` and confirm ZERO results. If any remain, replace them following the same pattern.

2. **Inline PageRouteBuilder sweep:**
   Run `grep -rn "PageRouteBuilder" frontend/lib/` and confirm the ONLY results are in `vlvt_routes.dart` (the parent class of VlvtPageRoute and VlvtFadeRoute). If any remain in screen files, consolidate them.

3. **Import verification:**
   Run `grep -rn "vlvt_routes" frontend/lib/` and confirm all 15 screen/service files that had navigation calls now import vlvt_routes.dart.

4. **Full test suite:**
   Run `flutter test` from the frontend directory. All 420+ tests must pass. If any fail, investigate whether the route change caused the failure (unlikely since duration is unchanged at 300ms) and fix.

5. **Static analysis:**
   Run `flutter analyze` on the entire lib/ directory. Must pass with no errors (existing info/warning baseline is acceptable).

If any issues found in steps 1-5, fix them in the same task before marking done.
  </action>
  <verify>
    <automated>cd "C:/Users/dasbl/AndroidStudioProjects/VLVT/frontend" && flutter analyze 2>&1 | tail -5 && flutter test 2>&1 | tail -10</automated>
  </verify>
  <done>
- `grep -rn "MaterialPageRoute" frontend/lib/` returns zero results
- `grep -rn "PageRouteBuilder" frontend/lib/` returns results ONLY in `vlvt_routes.dart`
- `flutter analyze` passes with no new errors
- `flutter test` passes with all tests green
- UX-03 verified: all 23 MaterialPageRoute + 10 inline PageRouteBuilder calls migrated
- UX-04 verified: Hero animations unaffected (opaque routes, same duration)
  </done>
</task>

</tasks>

<verification>
1. `grep -rn "MaterialPageRoute" frontend/lib/` → zero results (UX-03)
2. `grep -rn "PageRouteBuilder" frontend/lib/` → results only in `vlvt_routes.dart` (UX-03)
3. `flutter analyze` → no errors across entire lib/ directory
4. `flutter test` → all tests pass, no regressions
5. Hero animations (discovery profile cards, chat avatars) work correctly with VlvtPageRoute (UX-04) — verified by test pass and no `opaque: false` setting
</verification>

<success_criteria>
- Zero MaterialPageRoute calls in frontend/lib/
- Zero inline PageRouteBuilder calls outside vlvt_routes.dart
- 20 navigation calls replaced/consolidated across 7 screen files (10 MaterialPageRoute + 10 inline PageRouteBuilder)
- All 420+ existing tests pass
- flutter analyze clean
</success_criteria>

<output>
After completion, create `.planning/phases/10-page-transitions/10-02-SUMMARY.md`
</output>
